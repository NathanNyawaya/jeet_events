


<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Aviator Crashed Plane</title>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback" />
    <link rel="stylesheet" href="/plugins/fontawesome-free/css/all.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="/dist/css/adminlte.min.css" />
    <link rel="stylesheet" href="/css/admin.css" />
    <link href="//cdn.jsdelivr.net/npm/@sweetalert2/theme-dark@4/dark.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
    <style>
        body {
            font-family: 'Source Sans Pro', sans-serif;
        }

        .card-header {
            background-color: azure;
        }

        thead {
            background-color: azure;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-weight: 700;
        }
    </style>
</head>

<body class="hold-transition sidebar-mini">
    <div class="wrapper">
        <%- include('nav') %>
            <div class="content-wrapper">

                <section class="content-body">

                  <div class="container">
                    <div class="row mt-4">
                      <div class="col-12 col-lg-12">
                        <div class="card radius-15">
                          <div class="card-body d-flex align-items-center" style="margin: 0px; padding: 0px;">
                            <iframe src="http://aviatorsmall.playdreamgame.com/" style="width: 100%; height: 300px; border: 0;" title="aviator-pld"></iframe>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>



                  <div class="container">
                    <div class="card card-primary card-outline">
                      <div class="card-header">
                        <h3 class="card-title">Aviator Crashed Plane Settings</h3>
                        <div class="card-tools">
                            <div class="btn-group">
                                <button type="button" class="btn btn-tool dropdown-toggle" data-toggle="dropdown">
                                    <i class="fas fa-cog"></i>
                                </button>
                                <div class="dropdown-menu dropdown-menu-right" role="menu">
                                    <a class="dropdown-item" href="#" data-func="unpin">Unpin</a>
                                    <a class="dropdown-item" href="#" data-func="minimize">Minimize</a>
                                    <a class="dropdown-item" href="#" data-func="expand">Fullscreen</a>
                                </div>
                            </div>
                        </div>
                    </div>
    
                    <div style="overflow: hidden;">
                      
                    
                      <div class="container-fluid mt-4">
                        <div class="row">
                          <div class="col-12 col-lg-2">
                            <div class="card radius-15">
                              <div class="card-body d-flex align-items-center">
                                <div>
                                  <h4 class="mb-0 font-weight-bold" id="total-money">0</h4>
                                  <p class="mb-0">Total Money</p>
                                </div>
                                <div class="widgets-icons bg-light-primary text-primary rounded-circle ms-auto">
                                  <!-- SVG icon here -->
                                </div>
                              </div>
                            </div>
                          </div>
                        
                          <div class="col-12 col-lg-2">
                            <div class="card radius-15">
                              <div class="card-body d-flex align-items-center">
                                <div>
                                  <h4 class="mb-0 font-weight-bold" id="total-withdraw">0</h4>
                                  <p class="mb-0">Withdraw Money</p>
                                </div>
                                <div class="widgets-icons bg-light-success text-success rounded-circle ms-auto">
                                  <!-- SVG icon here -->
                                </div>
                              </div>
                            </div>
                          </div>
                        
                          <div class="col-12 col-lg-2">
                            <div class="card radius-15">
                              <div class="card-body d-flex align-items-center">
                                <div>
                                  <h4 class="mb-0 font-weight-bold" id="total-users">0</h4>
                                  <p class="mb-0">Total Users</p>
                                </div>
                                <div class="widgets-icons bg-light-danger text-danger rounded-circle ms-auto">
                                  <!-- SVG icon here -->
                                </div>
                              </div>
                            </div>
                          </div>
                        
                          <div class="col-12 col-lg-2">
                            <div class="card radius-15">
                              <div class="card-body d-flex align-items-center">
                                <div>
                                  <h4 class="mb-0 font-weight-bold" id="total-withdraw-users">0</h4>
                                  <p class="mb-0" style="font-size: 14px;">Total Withdraw Users</p>
                                </div>
                                <div class="widgets-icons bg-light-info text-info rounded-circle ms-auto">
                                  <!-- SVG icon here -->
                                </div>
                              </div>
                            </div>
                          </div>
                          <div class="col-12 col-lg-2">
                            <div class="card radius-15">
                              <div class="card-body d-flex align-items-center">
                                <div>
                                  <h4 class="mb-0 font-weight-bold" id="all-bet-users">0</h4>
                                  <p class="mb-0" style="font-size: 14px;">All Bet Users</p>
                                </div>
                                <div class="widgets-icons bg-light-info text-info rounded-circle ms-auto">
                                  <!-- SVG icon here -->
                                </div>
                              </div>
                            </div>
                          </div>

                          <div class="col-12 col-lg-2">
                            <div class="card radius-15">
                              <div class="card-body d-flex align-items-center">
                                <div>
                                  <h4 class="mb-0 font-weight-bold" id="total-bet-amount">0</h4>
                                  <p class="mb-0" style="font-size: 14px;">Total Bet Amount</p>
                                </div>
                                <div class="widgets-icons bg-light-info text-info rounded-circle ms-auto">
                                  <!-- SVG icon here -->
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        
                    

                    
                        <div class="wrapper mt-4 mb-4">
                          <button id="crashButton"  class="custom-btn btn-4 text-center btn btn-success">Crash Now</button>


                          <form class="row g-3 needs-validation" novalidate id="only_1_user">
                            <p style="font-size: 20px; font-family: cursive;">1. If No User is Playing</p>
                            <div class="col-md-3">
                              <label for="validationCustom01" class="form-label">Lower Range</label>
                              <input placeholder="Enter..." value="<%= settings.nl %>" type="text" class="form-control" id="only_1_user_lower_range" required min="1" max="10000" pattern="[1-9]\d{0,3}|10000" oninvalid="showErrorMessage(event, 'Please enter a number between 1 and 10000.')" />
                              <div class="valid-feedback">Looks good!</div>
                              <div class="invalid-feedback">Please enter a number between 1 and 10000.</div>
                            </div>
                            <div class="col-md-3">
                              <label for="validationCustom02" class="form-label">Upper Range</label>
                              <input placeholder="Enter..." type="number" class="form-control"  value="<%= settings.nh %>" id="only_1_user_upper_range" required min="1" max="10000" pattern="[1-9]\d{0,3}|10000" oninvalid="showErrorMessage(event, 'Please enter a number between 1 and 10000.')" />
                              <div class="valid-feedback">Looks good!</div>
                              <div class="invalid-feedback">Please enter a number between 1 and 10000.</div>
                            </div>
                            <div class="col-md-2 text-center crashnow-btn">

                            </div>
                            <div class="col-12">
                            </div>
                          </form>
                          <form class="row g-3 needs-validation mt-4 mb-4"  id="1_or_2_users">
                            <p style="font-size: 20px; font-family: cursive;">2. If (1, 2) User is Playing</p>
                            
                            <div class="col-md-3">
                                <label for="validationCustom03" class="form-label">Lower Range</label>
                                <input 
                                    placeholder="Enter..." 
                                    type="text" 
                                    class="form-control" 
                                    id="1_or_2_users_lower_range" 
                                    required 
                                    min="1" 
                                    value="<%= settings.sl %>"

                                    max="10000" 
                                    pattern="[1-9]\d{0,3}|10000" 
                                    oninvalid="showErrorMessage('Please enter a number between 1 and 10000.')"
                                />
                                <div class="valid-feedback">Looks good!</div>
                            </div>
                            
                            <div class="col-md-3">
                                <label for="validationCustom04" class="form-label">Upper Range</label>
                                <input 
                                    placeholder="Enter..." 
                                    type="number" 
                                    class="form-control" 
                                    id="1_or_2_users_upper_range" 
                                    required 
                                    min="1" 
                                    value="<%= settings.sm %>"

                                    max="10000" 
                                    pattern="[1-9]\d{0,3}|10000" 
                                    oninvalid="showErrorMessage('Please enter a number between 1 and 10000.')"
                                />
                                <div class="valid-feedback">Looks good!</div>
                            </div>
                            
                            <div class="col-md-3">
                                <label for="validationCustom05" class="form-label">Probability</label>
                                <input 
                                    placeholder="Enter..." 
                                    type="text" 
                                    class="form-control" 
                                    id="1_or_2_users_profitability" 
                                    required 
                                    value="<%= settings.sp %>"

                                    min="10" 
                                    max="100" 
                                    pattern="^(10|20|30|40|50|60|70|80|90|100)$" 
                                    oninvalid="showErrorMessage('Please enter a number that is a multiple of 10 and between 10 and 100.')"
                                />
                                <div class="valid-feedback">Looks good!</div>
                            </div>
                            
                            <div class="col-md-3">
                                <label for="validationCustom06" class="form-label">Single Max</label>
                                <input 
                                    placeholder="Enter..." 
                                    type="text" 
                                    class="form-control" 
                                    id="1_or_2_users_single_max" 
                                    required 
                                    min="1" 
                                    max="10000" 
                                    value="<%= settings.sm %>"

                                    pattern="^[1-9]\d*(\.\d+)?$" 
                                    oninvalid="showErrorMessage('Please enter a valid number.')"
                                />
                                <div class="valid-feedback">Looks good!</div>
                            </div>
                        
                            <div class="col-12">
                            </div>
                        </form>
                        
       


                          <form class="row g-3 needs-validation mt-4 mb-4" onsubmit="handleSubmits(event)" id="more_than_2_users">
                            <p style="font-size: 20px; font-family: cursive;">3. If more than 2 User is Playing</p>
                          
                            <div class="col-md-2">
                              <label for="validationCustom07" class="form-label">Lower Range</label>
                              <input
                                placeholder="Enter..."
                                type="text"
                                class="form-control"
                                id="more_than_2_users_lower_range"
                                required
                                min="1"
                                max="10000"
                                value="<%= settings.ml %>"
                                pattern="[1-9]\d{0,3}|10000"
                                oninvalid="showErrorMessage('Please enter a number between 1 and 10000.')"
                              />
                              <div class="valid-feedback">Looks good!</div>
                            </div>
                          
                            <div class="col-md-2">
                              <label for="validationCustom08" class="form-label">Upper Range</label>
                              <input
                                placeholder="Enter..."
                                type="number"
                                class="form-control"
                                id="more_than_2_users_upper_range"
                                required
                                min="1"
                                max="10000"
                                value="<%= settings.mh %>"

                                pattern="[1-9]\d{0,3}|10000"
                                oninvalid="showErrorMessage('Please enter a number between 1 and 10000.')"
                              />
                              <div class="valid-feedback">Looks good!</div>
                            </div>
                          
                            <div class="col-md-4">
                              <label for="validationCustom09" class="form-label">Margin Ratio</label>
                              <div style="display: flex; gap: 10px; flex-direction: column; position: relative;">
                                <input
                                  placeholder="Enter..."
                                  type="text"
                                  class="form-control"
                                  id="more_than_2_users_margin_ratio"
                                  value="<%= settings.mr %>"

                                  min="10"
                                  max="100"
                                  pattern="^(10|20|30|40|50|60|70|80|90|100)$"
                                  oninvalid="showErrorMessage('Please enter a number that is a multiple of 10 and between 10 to 100.')"
                                  oninput="clearErrorMessage()"
                                />
                                <div class="form-check form-switch lg-switch">
                                  <input
                                    class="form-check-input"
                                    type="checkbox"
                                    role="switch"
                                    id="marginSwitch"
                                  />
                                  <label class="form-check-label" for="marginSwitch"></label>
                                </div>
                              </div>
                              <div class="valid-feedback">Looks good!</div>
                            </div>
                          
                            <div class="col-md-2">
                              <label for="validationCustom10" class="form-label">Admin Profit</label>
                              <input
                                placeholder="Enter..."
                                type="text"
                                class="form-control"
                                id="more_than_2_users_admin_profit"
                                value="<%= settings.da %>"

                                required
                                min="1"
                                max="70"
                                pattern="^(70|[1-9][0-9]?)$"
                                oninvalid="showErrorMessage('Please enter a number between 1 and 70.')"
                              />
                              <div class="valid-feedback">Looks good!</div>
                            </div>
                          
                            <div class="col-12">
                              <button class="btn btn-primary" id="only_1_user_save" type="submit">Submit</button>
                            </div>
                          </form>
                          
  
                          
                        </div>
                      </div>
                    </div>
    
                  </div>



                  </div>

                  
           

                </section>

                

    
                  

           
            </div>

  
    </div>

    <script src="/plugins/jquery/jquery.min.js"></script>
    <script src="/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="/dist/js/adminlte.min.js"></script>
    <script src="/js/admin/admin.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>

    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

    <script>
      function showErrorMessage(message) {
        alert(message);
      }
    
      function clearErrorMessage() {
        // Function to clear custom validity messages
      }
    
      function handleSubmits(event) {
        event.preventDefault();
        // Add your form submission logic here
      }
    </script>

<script>
  function showErrorMessage(message) {
      alert(message);
  }

  function handleSubmits(event) {
      event.preventDefault();
      // Add your form submission logic here
  }
</script>


<script>
    function showErrorMessage(message) {
        alert(message);
    }

    async function handleSubmit(event) {
        event.preventDefault();

        const form = event.target;
        const formData = new FormData(form);

        try {
            const response = await fetch('/admin/getcrashed', {
                method: 'POST',
                body: formData
            });

            if (!response.ok) {
                throw new Error('Failed to save form data');
            }

            const data = await response.json();
            console.log(data);
            alert('Form data saved successfully!');
        } catch (error) {
            console.error(error);
            alert('Error occurred while saving form data!');
        }
    }

    async function handleSubmits(event) {
        event.preventDefault();

        const form = event.target;
        const formData = new FormData(form);

        try {
            const response = await fetch('/admin/getcurrentbet', {
                method: 'POST',
                body: formData
            });

            if (!response.ok) {
                throw new Error('Failed to save form data');
            }

            const data = await response.json();
            console.log(data);
            alert('Form data saved successfully!');
        } catch (error) {
            console.error(error);
            alert('Error occurred while saving form data!');
        }
    }

    function socketHandler() {
        // Function to handle socket request
    }
</script>


<script>
    // Connect to the WebSocket server
    const socket = io('ws://aviatorbackend.playdreamgame.com');

    // Event listener for the "crash" button click
    document.getElementById('crashButton').addEventListener('click', () => {
        // Emit a "crashedTime" event to the server
        socket.emit('crashedTime', new Date());

        console.log('Crashed');
    });

    // Listen for events from the server
    socket.on('someEventFromServer', (data) => {
        // Handle the event data here
    });

    // Listen for 'adminCrashedTime' event from the server
    socket.on('adminCrashedTime', (time) => {
        // Show SweetAlert notification
        Swal.fire({
            icon: 'success',
            title: 'Server Crashed',
            text: `Server crashed at ${time}`,
            timer: 3000,
            timerProgressBar: true,
            showConfirmButton: false
        });
    });
</script>


<script>
  $(document).ready(function () {


    $.ajax({
      type: "GET",
      url: "/admin/getAllAviatorData",
      success: function (response) {
        console.log(response);
        console.log('RRRRRRRRRRRRRRRRRRRRRRRRRRRRR');

        // Extracting data from the response object
        const data = response.data;

        // Updating HTML elements with the received data
        $('#total-money').text(data.totalBetAmount);
        $('#total-withdraw').text(data.totalWithdrawalAmount);
        $('#total-users').text(data.totalBets);
        $('#total-withdraw-users').text(data.totalWithdrawals);
        $('#all-bet-users').text(data.totalAllBetUsers);
        $('#total-bet-amount').text(data.totalBetAmount);

        // If you have other fields to update, you can do it similarly
        // For example, if you need to update a crashed plane data section
        // $('#crashed-nl').text(data.crashed.nl);
        // $('#crashed-nh').text(data.crashed.nh);
        // ... (continue for other crashed data fields)
      },
      error: function (err) {
        console.error("Error fetching aviator data:", err);
      }
    });


      $('#only_1_user_save').click(async function (e) {
          e.preventDefault();
          // Show spinner
          $('#spinner').show();

          // Extract form data
          let only_1_user_upper_range = $('#only_1_user_upper_range').val().trim();
          let only_1_user_lower_range = $('#only_1_user_lower_range').val().trim();
          let _1_or_2_users_single_max = $('#1_or_2_users_single_max').val().trim();
          let _1_or_2_users_profitability = $('#1_or_2_users_profitability').val().trim();
          let _1_or_2_users_upper_range = $('#1_or_2_users_upper_range').val().trim();
          let _1_or_2_users_lower_range = $('#1_or_2_users_lower_range').val().trim();
          let more_than_2_users_admin_profit = $('#more_than_2_users_admin_profit').val().trim();
          let more_than_2_users_margin_ratio = $('#more_than_2_users_margin_ratio').val().trim();
          let more_than_2_users_upper_range = $('#more_than_2_users_upper_range').val().trim();
          let more_than_2_users_lower_range = $('#more_than_2_users_lower_range').val().trim();
          // Construct payload object
          let payload = {
            nh: only_1_user_upper_range,
            nl: only_1_user_lower_range,
            sm: _1_or_2_users_single_max,
            sp: _1_or_2_users_profitability,
            sm: _1_or_2_users_upper_range,
            sl: _1_or_2_users_lower_range,
            da: more_than_2_users_admin_profit,
            mr: more_than_2_users_margin_ratio,
            mh: more_than_2_users_upper_range,
            ml: more_than_2_users_lower_range,
          };
          console.log(payload);

          // Send AJAX request to update payment settings
          $.ajax({
              url: '/admin/updateCrashData',
              type: 'POST',
              data: JSON.stringify(payload),
              contentType: "application/json",
              success: function (response) {
                console.log(response);
                  $('#spinner').hide();
                  Swal.fire({
                      title: 'Success!',
                      text: 'Payment settings have been saved successfully.',
                      icon: 'success',
                      confirmButtonText: 'OK'
                  });
              },
              error: function (xhr, status, error) {
                  console.log(xhr, status, error);
                  $('#spinner').hide();
                  Swal.fire({
                      title: 'Error!',
                      text: 'There was an error saving the payment settings.',
                      icon: 'error',
                      confirmButtonText: 'OK'
                  });
              }
          });
      });

    });


  // Function to set QR code image source and show modal
  function showQRCodeModal(imageSrc, modalId) {
      var modal = $(modalId);
      modal.find('img').attr('src', imageSrc);
      modal.modal('show');
  }

  function toBase64(file) {
  return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = () => resolve(reader.result);
      reader.onerror = error => reject(error);
  });
}

  // Set click event handlers for view buttons
  $('#upi-qr-view-btn').click(function () {
      showQRCodeModal('<%= settings.qrCodeUrl %>', '#upiQRModal');
  });

  $('#usdt-qr-view-btn').click(function () {
      showQRCodeModal('<%= settings.usdtQrCodeUrl %>', '#usdtQRModal');
  });
</script>


    
</body>

</html>
